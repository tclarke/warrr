---
- config:
  - testset: "User API tests"

- test:
  - group: "User CRUD"
  - name: "Ensure user doesn't exist"
  - url: "/api/v1/user/testuser/"
  - expected_status: [404]

- test:
  - group: "User CRUD"
  - name: "Create user"
  - url: "/api/v1/user/"
  - method: "POST"
  - body: '{"username": "testuser", "first_name": "Test", "last_name": "User"}'
  - headers: {'Content-Type': 'application/json'}
  - validators:
    - compare: {header: location, comparator: contains, expected: '/api/v1/user/testuser/'}

- test:
  - group: "User CRUD"
  - name: "Ensure user exists"
  - url: "/api/v1/user/testuser/"
  - validators:
    - compare: {header: content-type, comparator: contains, expected: 'json'}
    - compare: {jsonpath_mini: 'first_name', expected: 'Test'}
    - compare: {jsonpath_mini: 'last_name', expected: 'User'}

- test:
  - group: "User CRUD"
  - name: "Modify the user"
  - url: "/api/v1/user/testuser/"
  - method: "PUT"
  - body: '{"first_name": "Jimbo"}'
  - headers: {'Content-Type': 'application/json'}
  - validators:
    - compare: {header: content-type, comparator: contains, expected: 'json'}
    - compare: {jsonpath_mini: 'first_name', expected: 'Jimbo'}
    - compare: {jsonpath_mini: 'last_name', expected: 'User'}

- test:
  - group: "User CRUD"
  - name: "Delete user"
  - url: "/api/v1/user/testuser/"
  - method: "DELETE"

- test:
  - group: "User CRUD"
  - name: "Ensure user was deleted"
  - url: "/api/v1/user/testuser/"
  - expected_status: [404]

